<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€å†ç”Ÿæˆå™¨</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: #f0f0f0;
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        /* å·¦ä¾§ç¼–è¾‘åŒº */
        .editor-panel {
            width: 380px;
            background: white;
            border-right: 1px solid #ddd;
            overflow-y: auto;
            flex-shrink: 0;
        }

        .editor-panel::-webkit-scrollbar {
            width: 6px;
        }

        .editor-panel::-webkit-scrollbar-thumb {
            background: #999;
            border-radius: 3px;
        }

        .editor-header {
            text-align: center;
            padding: 15px;
            background: #000;
            color: white;
        }

        .editor-header h1 {
            font-size: 20px;
            font-weight: 600;
        }

        .module-toggle {
            margin: 15px;
            padding: 12px;
            background: #f5f5f5;
            border-radius: 6px;
        }

        .module-toggle h3 {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .module-order-item {
            display: flex;
            align-items: center;
            padding: 6px 8px;
            background: white;
            margin-bottom: 6px;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
        }

        .module-order-item:last-child {
            margin-bottom: 0;
        }

        .module-order-item .drag-handle {
            cursor: move;
            margin-right: 8px;
            color: #999;
            font-size: 14px;
        }

        .module-order-item input[type="checkbox"] {
            margin-right: 8px;
            cursor: pointer;
        }

        .module-order-item label {
            flex: 1;
            font-size: 11px;
            cursor: pointer;
        }

        .module-order-buttons {
            display: flex;
            gap: 2px;
        }

        .module-order-buttons button {
            padding: 2px 6px;
            font-size: 10px;
            background: #e0e0e0;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        .module-order-buttons button:hover {
            background: #d0d0d0;
        }

        .module-order-buttons button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .form-section {
            margin: 0 15px 15px;
            padding: 12px;
            background: #f5f5f5;
            border-radius: 6px;
        }

        .form-section h3 {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .form-group {
            margin-bottom: 10px;
        }

        .form-group label {
            display: block;
            font-size: 11px;
            font-weight: 500;
            margin-bottom: 3px;
            color: #666;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #000;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 50px;
        }

        .dynamic-list {
            margin-top: 8px;
        }

        .dynamic-item {
            background: white;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 8px;
            border: 1px solid #e0e0e0;
        }

        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #000;
            color: white;
        }

        .btn-primary:hover {
            background: #333;
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .btn-success {
            background: #4CAF50;
            color: white;
        }

        .btn-success:hover {
            background: #45a049;
        }

        .btn-danger {
            background: #ff4444;
            color: white;
            padding: 3px 8px;
            font-size: 10px;
        }

        .btn-add {
            width: 100%;
            margin-top: 6px;
        }

        .export-buttons {
            position: sticky;
            bottom: 0;
            background: white;
            padding: 12px;
            border-top: 1px solid #ddd;
            margin: 0 -15px -15px -15px;
        }

        .export-buttons .btn {
            width: 100%;
            margin-bottom: 6px;
        }

        .json-buttons {
            display: flex;
            gap: 6px;
            margin-bottom: 10px;
        }

        .json-buttons .btn {
            flex: 1;
            margin-bottom: 0;
        }

        /* å³ä¾§é¢„è§ˆåŒº */
        .preview-panel {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            background: #e0e0e0;
        }

        .preview-panel::-webkit-scrollbar {
            width: 8px;
        }

        .preview-panel::-webkit-scrollbar-thumb {
            background: #999;
            border-radius: 4px;
        }

        /* ç®€å†æ ·å¼ - ä¸¥æ ¼A4å°ºå¯¸ */
        .resume {
            width: 210mm;
            min-height: 297mm;
            max-height: 297mm;
            background: white;
            padding: 12mm 15mm;
            box-sizing: border-box;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        /* å¤´åƒåœ¨å³ä¸Šè§’ - å°å°ºå¯¸é•¿æ–¹å½¢ */
        .avatar-container {
            position: absolute;
            top: 8mm;
            right: 15mm;
            width: 25mm;
            height: 32mm;
        }

        .avatar-upload {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            overflow: hidden;
            background: #f5f5f5;
            position: relative;
        }

        .avatar-upload img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .avatar-upload .placeholder {
            font-size: 9px;
            color: #bbb;
            text-align: center;
            padding: 5px;
            line-height: 1.3;
        }

        .avatar-upload input[type="file"] {
            display: none;
        }

        .header-content {
            padding-right: 30mm;
        }

        .resume-name {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 4px;
            color: #000;
            letter-spacing: 2px;
        }

        .resume-title {
            font-size: 13px;
            color: #666;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .contact-info {
            display: flex;
            flex-wrap: wrap;
            gap: 8px 15px;
            font-size: 10px;
            color: #333;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .contact-item svg {
            width: 12px;
            height: 12px;
            flex-shrink: 0;
        }

        .resume-section {
            margin-bottom: 14px;
        }

        #section-education {
            margin-top: 20px;
        }

        .section-title {
            font-size: 13px;
            font-weight: 700;
            margin-bottom: 8px;
            color: #000;
            display: flex;
            align-items: center;
            gap: 6px;
            letter-spacing: 1px;
            border-bottom: 1px solid #000;
            padding-bottom: 3px;
        }

        .section-title svg {
            width: 14px;
            height: 14px;
        }

        /* ç´§å‡‘å¸ƒå±€ */
        .education-item,
        .work-item,
        .project-item,
        .research-item {
            margin-bottom: 8px;
            font-size: 11px;
        }

        .education-item:last-child,
        .work-item:last-child,
        .project-item:last-child,
        .research-item:last-child {
            margin-bottom: 0;
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 2px;
        }

        .item-title {
            font-size: 12px;
            font-weight: 600;
            color: #000;
        }

        .item-date {
            font-size: 11px;
            color: #999;
        }

        .item-subtitle {
            font-size: 11px;
            color: #666;
            margin-bottom: 3px;
        }

        .item-description {
            font-size: 11px;
            color: #666;
            line-height: 1.5;
        }

        /* æ•™è‚²ç»å†ä¸€è¡Œæ˜¾ç¤º */
        .education-item .item-header {
            flex-wrap: wrap;
            gap: 5px;
        }

        .education-main {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 8px 15px;
            flex: 1;
        }

        .education-main span {
            font-size: 11px;
            color: #666;
        }

        .education-main .item-title {
            font-size: 12px;
            font-weight: 600;
            color: #000;
        }

        .skills-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .skill-tag {
            padding: 3px 8px;
            background: #f5f5f5;
            border-radius: 3px;
            font-size: 11px;
            color: #333;
        }

        .awards-list,
        .portfolio-list,
        .other-list {
            list-style: none;
        }

        .awards-list li,
        .portfolio-list li,
        .other-list li {
            font-size: 11px;
            color: #666;
            padding: 3px 0;
            padding-left: 12px;
            position: relative;
            line-height: 1.4;
        }

        .awards-list li::before,
        .portfolio-list li::before,
        .other-list li::before {
            content: 'â–ª';
            position: absolute;
            left: 0;
            color: #000;
        }

        .intro-text {
            font-size: 11px;
            color: #666;
            line-height: 1.6;
            text-align: justify;
        }

        .hidden {
            display: none !important;
        }

        @media print {
            body {
                background: white;
            }

            .container {
                height: auto;
            }

            .editor-panel {
                display: none;
            }

            .preview-panel {
                padding: 0;
                overflow: visible;
            }

            .resume {
                box-shadow: none;
            }

            .avatar-upload input[type="file"] {
                display: none;
            }
        }

        /* æ–‡ä»¶ä¸Šä¼ éšè— */
        #json-import {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å·¦ä¾§ç¼–è¾‘åŒº -->
        <div class="editor-panel">
            <div class="editor-header">
                <h1>ç®€å†ç”Ÿæˆå™¨</h1>
            </div>

            <!-- JSONå¯¼å…¥å¯¼å‡º -->
            <div class="form-section">
                <h3>ğŸ’¾ æ•°æ®ç®¡ç†</h3>
                <div class="json-buttons">
                    <button class="btn btn-success" onclick="exportJSON()">å¯¼å‡ºJSON</button>
                    <button class="btn btn-secondary" onclick="document.getElementById('json-import').click()">å¯¼å…¥JSON</button>
                    <input type="file" id="json-import" accept=".json" onchange="importJSON(event)">
                </div>
                <button class="btn btn-danger" style="width: 100%; margin-top: 8px;" onclick="clearCache()">ğŸ—‘ï¸ æ¸…é™¤æœ¬åœ°ç¼“å­˜</button>
            </div>

            <!-- æ¨¡å—å¼€å…³ -->
            <div class="module-toggle">
                <h3>ğŸ“‹ æ¨¡å—é€‰æ‹©ä¸æ’åº</h3>
                <div id="module-order-list"></div>
            </div>

            <!-- åŸºæœ¬ä¿¡æ¯ -->
            <div class="form-section">
                <h3>ğŸ‘¤ åŸºæœ¬ä¿¡æ¯</h3>
                <div class="form-group">
                    <label>å§“å</label>
                    <input type="text" id="input-name" placeholder="è¯·è¾“å…¥å§“å" value="å¼ ä¸‰">
                </div>
                <div class="form-group">
                    <label>æ±‚èŒå¤´è¡”</label>
                    <input type="text" id="input-job-title" placeholder="å¦‚ï¼šè½¯ä»¶å·¥ç¨‹å¸ˆ" value="è½¯ä»¶å·¥ç¨‹å¸ˆ">
                </div>
                <div class="form-group">
                    <label>ç”µè¯</label>
                    <input type="text" id="input-phone" placeholder="æ‰‹æœºå·ç " value="138-0000-0000">
                </div>
                <div class="form-group">
                    <label>é‚®ç®±</label>
                    <input type="text" id="input-email" placeholder="é‚®ç®±åœ°å€" value="zhangsan@email.com">
                </div>
                <div class="form-group">
                    <label>åœ°å€</label>
                    <input type="text" id="input-location" placeholder="æ‰€åœ¨åŸå¸‚" value="åŒ—äº¬å¸‚">
                </div>
                <div class="form-group">
                    <label>ä¸ªäººç½‘ç«™</label>
                    <input type="text" id="input-website" placeholder="ä¸ªäººåšå®¢/ç½‘ç«™" value="">
                </div>
                <div class="form-group">
                    <label>GitHub</label>
                    <input type="text" id="input-github" placeholder="GitHubç”¨æˆ·å" value="zhangsan">
                </div>
            </div>

            <!-- æ•™è‚²ç»å† -->
            <div class="form-section">
                <h3>ğŸ“ æ•™è‚²ç»å†</h3>
                <div id="education-list"></div>
                <button class="btn btn-secondary btn-add" onclick="addEducation()">+ æ·»åŠ æ•™è‚²ç»å†</button>
            </div>

            <!-- ä¸“ä¸šæŠ€èƒ½ -->
            <div class="form-section">
                <h3>ğŸ’¼ ä¸“ä¸šæŠ€èƒ½</h3>
                <div class="form-group">
                    <label>æŠ€èƒ½æè¿°</label>
                    <textarea id="input-skills" placeholder="è¯·è‡ªç”±æè¿°æ‚¨çš„ä¸“ä¸šæŠ€èƒ½å’Œç‰¹é•¿">ç†Ÿç»ƒæŒæ¡ Javaã€Pythonã€JavaScript ç­‰ç¼–ç¨‹è¯­è¨€ï¼›ç²¾é€š Reactã€Vue å‰ç«¯æ¡†æ¶ï¼›ç†Ÿæ‚‰ Node.js åç«¯å¼€å‘ï¼›å…·å¤‡ MySQL æ•°æ®åº“è®¾è®¡å’Œä¼˜åŒ–èƒ½åŠ›ï¼›ç†Ÿç»ƒä½¿ç”¨ Git ç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼›äº†è§£ Docker å®¹å™¨åŒ–éƒ¨ç½²å’Œ CI/CD æµç¨‹ã€‚</textarea>
                </div>
            </div>

            <!-- å·¥ä½œç»å† -->
            <div class="form-section">
                <h3>ğŸ’¼ å·¥ä½œç»å†</h3>
                <div id="work-list"></div>
                <button class="btn btn-secondary btn-add" onclick="addWork()">+ æ·»åŠ å·¥ä½œç»å†</button>
            </div>

            <!-- é¡¹ç›®ç»å† -->
            <div class="form-section">
                <h3>ğŸ”§ é¡¹ç›®ç»å†</h3>
                <div id="project-list"></div>
                <button class="btn btn-secondary btn-add" onclick="addProject()">+ æ·»åŠ é¡¹ç›®ç»å†</button>
            </div>

            <!-- è£èª‰å¥–é¡¹ -->
            <div class="form-section">
                <h3>ğŸ† è£èª‰å¥–é¡¹</h3>
                <div class="form-group">
                    <label>å¥–é¡¹åˆ—è¡¨ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
                    <textarea id="input-awards" placeholder="æ¯è¡Œä¸€ä¸ªå¥–é¡¹">2023å¹´ å›½å®¶å¥–å­¦é‡‘
2022å¹´ ä¼˜ç§€å­¦ç”Ÿå¹²éƒ¨
2021å¹´ å­¦ä¸šä¸€ç­‰å¥–å­¦é‡‘</textarea>
                </div>
            </div>

            <!-- ç ”ç©¶ç»å† -->
            <div class="form-section">
                <h3>ğŸ”¬ ç ”ç©¶ç»å†</h3>
                <div id="research-list"></div>
                <button class="btn btn-secondary btn-add" onclick="addResearch()">+ æ·»åŠ ç ”ç©¶ç»å†</button>
            </div>

            <!-- ä½œå“é›† -->
            <div class="form-section">
                <h3>ğŸ¨ ä½œå“é›†</h3>
                <div class="form-group">
                    <label>ä½œå“åˆ—è¡¨ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
                    <textarea id="input-portfolio" placeholder="æ¯è¡Œä¸€ä¸ªä½œå“">GitHub: github.com/zhangsan
ä¸ªäººåšå®¢: zhangsan.blog</textarea>
                </div>
            </div>

            <!-- æ±‚èŒæ„å‘ -->
            <div class="form-section">
                <h3>ğŸ¯ æ±‚èŒæ„å‘</h3>
                <div class="form-group">
                    <label>æœŸæœ›èŒä½</label>
                    <input type="text" id="input-position" placeholder="æœŸæœ›èŒä½" value="è½¯ä»¶å·¥ç¨‹å¸ˆ">
                </div>
                <div class="form-group">
                    <label>æœŸæœ›åŸå¸‚</label>
                    <input type="text" id="input-city" placeholder="æœŸæœ›åŸå¸‚" value="åŒ—äº¬/ä¸Šæµ·/æ·±åœ³">
                </div>
                <div class="form-group">
                    <label>æœŸæœ›è–ªèµ„</label>
                    <input type="text" id="input-salary" placeholder="æœŸæœ›è–ªèµ„" value="é¢è®®">
                </div>
            </div>

            <!-- å…¶ä»–ç»å† -->
            <div class="form-section">
                <h3>ğŸ“ å…¶ä»–ç»å†</h3>
                <div class="form-group">
                    <label>ç»å†åˆ—è¡¨ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
                    <textarea id="input-other" placeholder="æ¯è¡Œä¸€ä¸ªç»å†">2020-2022 æ ¡å­¦ç”Ÿä¼šä¸»å¸­
2019-2021 æ ¡å¿—æ„¿è€…æœåŠ¡é˜Ÿ</textarea>
                </div>
            </div>

            <!-- ä¸ªäººç®€ä»‹ -->
            <div class="form-section">
                <h3>âœ¨ ä¸ªäººç®€ä»‹</h3>
                <div class="form-group">
                    <label>ç®€ä»‹å†…å®¹</label>
                    <textarea id="input-intro">çƒ­çˆ±ç¼–ç¨‹ï¼Œå…·æœ‰æ‰å®çš„è®¡ç®—æœºåŸºç¡€çŸ¥è¯†ã€‚åœ¨æ ¡æœŸé—´å¤šæ¬¡å‚ä¸é¡¹ç›®å¼€å‘ï¼Œå…·å¤‡è‰¯å¥½çš„å›¢é˜Ÿåä½œèƒ½åŠ›å’Œé—®é¢˜è§£å†³èƒ½åŠ›ã€‚å¯¹æ–°æŠ€æœ¯å……æ»¡çƒ­æƒ…ï¼ŒæŒç»­å­¦ä¹ æå‡è‡ªå·±ã€‚</textarea>
                </div>
            </div>

            <!-- å¯¼å‡ºæŒ‰é’® -->
            <div class="export-buttons">
                <button class="btn btn-primary" onclick="exportPDF()">ğŸ“„ å¯¼å‡º PDF</button>
                <button class="btn btn-secondary" onclick="exportImage()">ğŸ–¼ï¸ å¯¼å‡ºå›¾ç‰‡</button>
            </div>
        </div>

        <!-- å³ä¾§é¢„è§ˆåŒº -->
        <div class="preview-panel">
            <div class="resume" id="resume">
                <!-- å¤´åƒ - å³ä¸Šè§’ -->
                <div class="avatar-container" id="resume-avatar">
                    <div class="avatar-upload" onclick="document.getElementById('avatar-input').click()">
                        <div class="placeholder">ç‚¹å‡»ä¸Šä¼ ç…§ç‰‡</div>
                        <img id="avatar-img" class="hidden" alt="å¤´åƒ">
                    </div>
                    <input type="file" id="avatar-input" accept="image/*" style="display: none;" onchange="handleAvatarUpload(event)">
                </div>

                <!-- å¤´éƒ¨å†…å®¹ -->
                <div class="header-content">
                    <div class="resume-name" id="resume-name">å¼ ä¸‰</div>
                    <div class="resume-title" id="resume-job-title">è½¯ä»¶å·¥ç¨‹å¸ˆ</div>
                    <div class="contact-info" id="resume-contact">
                        <div class="contact-item" id="contact-phone">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg>
                            <span id="resume-phone">138-0000-0000</span>
                        </div>
                        <div class="contact-item" id="contact-email">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>
                            <span id="resume-email">zhangsan@email.com</span>
                        </div>
                        <div class="contact-item" id="contact-location">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
                            <span id="resume-location">åŒ—äº¬å¸‚</span>
                        </div>
                        <div class="contact-item hidden" id="contact-website">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
                            <span id="resume-website"></span>
                        </div>
                        <div class="contact-item hidden" id="contact-github">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.17.66-.45v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.54.67.45C19.14 20.16 22 16.42 22 12A10 10 0 0012 2z"/></svg>
                            <span id="resume-github"></span>
                        </div>
                    </div>
                </div>

                <!-- æ•™è‚²ç»å† -->
                <div class="resume-section" id="section-education">
                    <div class="section-title">
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 3L1 9l4 2.18v6L12 21l7-3.82v-6l2-1.09V17h2V9L12 3zm6.82 6L12 12.72 5.18 9 12 5.28 18.82 9zM17 15.99l-5 2.73-5-2.73v-3.72L12 15l5-2.73v3.72z"/></svg>
                        æ•™è‚²ç»å†
                    </div>
                    <div id="resume-education"></div>
                </div>

                <!-- ä¸“ä¸šæŠ€èƒ½ -->
                <div class="resume-section" id="section-skills">
                    <div class="section-title">
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65z"/></svg>
                        ä¸“ä¸šæŠ€èƒ½
                    </div>
                    <div class="item-description" id="resume-skills"></div>
                </div>

                <!-- å·¥ä½œç»å† -->
                <div class="resume-section" id="section-work">
                    <div class="section-title">
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 6h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-6 0h-4V4h4v2z"/></svg>
                        å·¥ä½œç»å†
                    </div>
                    <div id="resume-work"></div>
                </div>

                <!-- é¡¹ç›®ç»å† -->
                <div class="resume-section" id="section-project">
                    <div class="section-title">
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-2.06 11L15 15.28 12.06 17l.78-3.33-2.59-2.24 3.41-.29L15 8l1.34 3.14 3.41.29-2.59 2.24.78 3.33z"/></svg>
                        é¡¹ç›®ç»å†
                    </div>
                    <div id="resume-project"></div>
                </div>

                <!-- è£èª‰å¥–é¡¹ -->
                <div class="resume-section" id="section-awards">
                    <div class="section-title">
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 5h-2V3H7v2H5c-1.1 0-2 .9-2 2v1c0 2.55 1.92 4.63 4.39 4.94.63 1.5 1.98 2.63 3.61 2.96V19H7v2h10v-2h-4v-3.1c1.63-.33 2.98-1.46 3.61-2.96C19.08 12.63 21 10.55 21 8V7c0-1.1-.9-2-2-2z"/></svg>
                        è£èª‰å¥–é¡¹
                    </div>
                    <ul class="awards-list" id="resume-awards"></ul>
                </div>

                <!-- ç ”ç©¶ç»å† -->
                <div class="resume-section" id="section-research">
                    <div class="section-title">
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z"/></svg>
                        ç ”ç©¶ç»å†
                    </div>
                    <div id="resume-research"></div>
                </div>

                <!-- ä½œå“é›† -->
                <div class="resume-section" id="section-portfolio">
                    <div class="section-title">
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-5 14H4v-4h11v4zm0-5H4V7h11v4zm5 5h-4V7h4v9z"/></svg>
                        ä½œå“é›†
                    </div>
                    <ul class="portfolio-list" id="resume-portfolio"></ul>
                </div>

                <!-- æ±‚èŒæ„å‘ -->
                <div class="resume-section" id="section-objective">
                    <div class="section-title">
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
                        æ±‚èŒæ„å‘
                    </div>
                    <div class="education-item">
                        <div class="item-header">
                            <div class="item-title" id="resume-position">è½¯ä»¶å·¥ç¨‹å¸ˆ</div>
                        </div>
                        <div class="education-info">
                            <span>æœŸæœ›åŸå¸‚: <strong id="resume-city">åŒ—äº¬/ä¸Šæµ·/æ·±åœ³</strong></span>
                            <span>æœŸæœ›è–ªèµ„: <strong id="resume-salary">é¢è®®</strong></span>
                        </div>
                    </div>
                </div>

                <!-- å…¶ä»–ç»å† -->
                <div class="resume-section" id="section-other">
                    <div class="section-title">
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>
                        å…¶ä»–ç»å†
                    </div>
                    <ul class="other-list" id="resume-other"></ul>
                </div>

                <!-- ä¸ªäººç®€ä»‹ -->
                <div class="resume-section" id="section-intro">
                    <div class="section-title">
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                        ä¸ªäººç®€ä»‹
                    </div>
                    <div class="intro-text" id="resume-intro"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ•°æ®å­˜å‚¨
        let resumeData = {
            basic: {
                name: 'å¼ ä¸‰',
                jobTitle: 'è½¯ä»¶å·¥ç¨‹å¸ˆ',
                phone: '138-0000-0000',
                email: 'zhangsan@email.com',
                location: 'åŒ—äº¬å¸‚',
                website: '',
                github: 'zhangsan'
            },
            education: [
                { school: 'æ¸…åå¤§å­¦', major: 'è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯', degree: 'å­¦å£«', time: '2019.09 - 2023.06' }
            ],
            skills: 'Java, Python, JavaScript, React, Vue, Node.js, MySQL, Git',
            work: [
                { company: 'æŸæŸç§‘æŠ€å…¬å¸', position: 'å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ', time: '2023.07 - è‡³ä»Š', description: 'è´Ÿè´£å…¬å¸æ ¸å¿ƒäº§å“çš„å‰ç«¯å¼€å‘å·¥ä½œï¼Œä½¿ç”¨ReactæŠ€æœ¯æ ˆã€‚' }
            ],
            project: [
                { name: 'åœ¨çº¿æ•™è‚²å¹³å°', role: 'å‰ç«¯è´Ÿè´£äºº', time: '2022.03 - 2022.06', description: 'ä½¿ç”¨Vue3å¼€å‘åœ¨çº¿æ•™è‚²å¹³å°ï¼Œå®ç°è§†é¢‘æ’­æ”¾ã€åœ¨çº¿ç­”é¢˜ç­‰åŠŸèƒ½ã€‚' }
            ],
            awards: '2023å¹´ å›½å®¶å¥–å­¦é‡‘\n2022å¹´ ä¼˜ç§€å­¦ç”Ÿå¹²éƒ¨\n2021å¹´ å­¦ä¸šä¸€ç­‰å¥–å­¦é‡‘',
            research: [
                { title: 'æ·±åº¦å­¦ä¹ åœ¨å›¾åƒè¯†åˆ«ä¸­çš„åº”ç”¨', role: 'ç ”ç©¶åŠ©ç†', time: '2021.09 - 2022.01', description: 'å‚ä¸å¯¼å¸ˆçš„ç§‘ç ”é¡¹ç›®ï¼Œè´Ÿè´£æ•°æ®é¢„å¤„ç†å’Œæ¨¡å‹è®­ç»ƒã€‚' }
            ],
            portfolio: 'GitHub: github.com/zhangsan\nä¸ªäººåšå®¢: zhangsan.blog',
            objective: {
                position: 'è½¯ä»¶å·¥ç¨‹å¸ˆ',
                city: 'åŒ—äº¬/ä¸Šæµ·/æ·±åœ³',
                salary: 'é¢è®®'
            },
            other: '2020-2022 æ ¡å­¦ç”Ÿä¼šä¸»å¸­\n2019-2021 æ ¡å¿—æ„¿è€…æœåŠ¡é˜Ÿ',
            intro: 'çƒ­çˆ±ç¼–ç¨‹ï¼Œå…·æœ‰æ‰å®çš„è®¡ç®—æœºåŸºç¡€çŸ¥è¯†ã€‚åœ¨æ ¡æœŸé—´å¤šæ¬¡å‚ä¸é¡¹ç›®å¼€å‘ï¼Œå…·å¤‡è‰¯å¥½çš„å›¢é˜Ÿåä½œèƒ½åŠ›å’Œé—®é¢˜è§£å†³èƒ½åŠ›ã€‚å¯¹æ–°æŠ€æœ¯å……æ»¡çƒ­æƒ…ï¼ŒæŒç»­å­¦ä¹ æå‡è‡ªå·±ã€‚'
        };

        let avatarDataUrl = '';

        // æ¨¡å—é¡ºåºé…ç½®
        let moduleOrder = [
            { id: 'skills', name: 'ä¸“ä¸šæŠ€èƒ½', section: 'section-skills', toggle: 'toggle-skills', visible: true },
            { id: 'work', name: 'å·¥ä½œç»å†', section: 'section-work', toggle: 'toggle-work', visible: true },
            { id: 'project', name: 'é¡¹ç›®ç»å†', section: 'section-project', toggle: 'toggle-project', visible: true },
            { id: 'awards', name: 'è£èª‰å¥–é¡¹', section: 'section-awards', toggle: 'toggle-awards', visible: true },
            { id: 'research', name: 'ç ”ç©¶ç»å†', section: 'section-research', toggle: 'toggle-research', visible: true },
            { id: 'portfolio', name: 'ä½œå“é›†', section: 'section-portfolio', toggle: 'toggle-portfolio', visible: true },
            { id: 'objective', name: 'æ±‚èŒæ„å‘', section: 'section-objective', toggle: 'toggle-objective', visible: false },
            { id: 'other', name: 'å…¶ä»–ç»å†', section: 'section-other', toggle: 'toggle-other', visible: false },
            { id: 'intro', name: 'ä¸ªäººç®€ä»‹', section: 'section-intro', toggle: 'toggle-intro', visible: false }
        ];

        // å›ºå®šæ¨¡å—ï¼ˆä¸å¯è°ƒæ•´é¡ºåºï¼‰
        const fixedModules = {
            avatar: { id: 'toggle-avatar', name: 'äººåƒç…§', section: 'resume-avatar', visible: true },
            contact: { id: 'toggle-contact', name: 'åŸºæœ¬ä¿¡æ¯', section: 'resume-contact', visible: true },
            education: { id: 'toggle-education', name: 'æ•™è‚²ç»å†', section: 'section-education', visible: true }
        };

        // æ¸²æŸ“æ¨¡å—é¡ºåºåˆ—è¡¨
        function renderModuleOrder() {
            const container = document.getElementById('module-order-list');

            // æ¸²æŸ“å›ºå®šæ¨¡å—ï¼ˆæ— ä¸Šä¸‹ç§»åŠ¨æŒ‰é’®ï¼‰
            const fixedHtml = Object.values(fixedModules).map(module => `
                <div class="module-order-item" style="background: #e8e8e8;">
                    <span class="drag-handle" style="opacity: 0.3;">â˜°</span>
                    <input type="checkbox" id="${module.id}" ${module.visible ? 'checked' : ''} onchange="toggleFixedModule('${module.id}')">
                    <label for="${module.id}">${module.name}</label>
                    <div class="module-order-buttons">
                        <button disabled style="opacity: 0.3;">å›ºå®š</button>
                    </div>
                </div>
            `).join('');

            // æ¸²æŸ“å¯è°ƒæ•´é¡ºåºçš„æ¨¡å—
            const reorderableHtml = moduleOrder.map((module, index) => `
                <div class="module-order-item">
                    <span class="drag-handle">â˜°</span>
                    <input type="checkbox" id="${module.toggle}" ${module.visible ? 'checked' : ''} onchange="toggleModuleVisibility(${index})">
                    <label for="${module.toggle}">${module.name}</label>
                    <div class="module-order-buttons">
                        <button onclick="moveModuleUp(${index})" ${index === 0 ? 'disabled' : ''}>â†‘</button>
                        <button onclick="moveModuleDown(${index})" ${index === moduleOrder.length - 1 ? 'disabled' : ''}>â†“</button>
                    </div>
                </div>
            `).join('');

            container.innerHTML = fixedHtml + reorderableHtml;
        }

        // åˆ‡æ¢å›ºå®šæ¨¡å—çš„å¯è§æ€§
        function toggleFixedModule(toggleId) {
            const moduleKey = Object.keys(fixedModules).find(key => fixedModules[key].id === toggleId);
            if (moduleKey) {
                fixedModules[moduleKey].visible = !fixedModules[moduleKey].visible;
                const element = document.getElementById(fixedModules[moduleKey].section);
                if (element) {
                    element.classList.toggle('hidden', !fixedModules[moduleKey].visible);
                }
                saveToLocalStorage();
            }
        }

        // ä¸Šç§»æ¨¡å—
        function moveModuleUp(index) {
            if (index > 0) {
                [moduleOrder[index - 1], moduleOrder[index]] = [moduleOrder[index], moduleOrder[index - 1]];
                renderModuleOrder();
                reorderSections();
                saveToLocalStorage();
            }
        }

        // ä¸‹ç§»æ¨¡å—
        function moveModuleDown(index) {
            if (index < moduleOrder.length - 1) {
                [moduleOrder[index], moduleOrder[index + 1]] = [moduleOrder[index + 1], moduleOrder[index]];
                renderModuleOrder();
                reorderSections();
                saveToLocalStorage();
            }
        }

        // åˆ‡æ¢æ¨¡å—å¯è§æ€§
        function toggleModuleVisibility(index) {
            moduleOrder[index].visible = !moduleOrder[index].visible;
            const module = moduleOrder[index];
            const element = document.getElementById(module.section);
            if (element) {
                element.classList.toggle('hidden', !module.visible);
            }
            saveToLocalStorage();
        }

        // é‡æ–°æ’åºç®€å†é¢„è§ˆåŒºçš„æ¨¡å—
        function reorderSections() {
            const resume = document.getElementById('resume');
            const sections = {};

            // æ”¶é›†æ‰€æœ‰section
            moduleOrder.forEach(module => {
                const element = document.getElementById(module.section);
                if (element) {
                    sections[module.section] = element;
                }
            });

            // æ‰¾åˆ°æ•™è‚²ç»å†sectionçš„ä½ç½®ä½œä¸ºå‚è€ƒç‚¹
            const educationSection = document.getElementById('section-education');
            if (educationSection) {
                // æŒ‰ç…§moduleOrderçš„é¡ºåºé‡æ–°æ’å…¥
                moduleOrder.forEach(module => {
                    const element = sections[module.section];
                    if (element && element !== educationSection) {
                        resume.appendChild(element);
                    }
                });
            }
        }

        // ä»localStorageåŠ è½½æ•°æ®
        function loadFromLocalStorage() {
            try {
                const saved = localStorage.getItem('resumeData');
                if (saved) {
                    const data = JSON.parse(saved);

                    // åŠ è½½æ¨¡å—é¡ºåº
                    if (data.moduleOrder) {
                        moduleOrder = data.moduleOrder;
                    }

                    // åŠ è½½å›ºå®šæ¨¡å—é…ç½®
                    if (data.fixedModules) {
                        Object.assign(fixedModules, data.fixedModules);
                    }

                    return data;
                }
            } catch (e) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', e);
            }
            return null;
        }

        // ä¿å­˜åˆ°localStorage
        function saveToLocalStorage() {
            try {
                collectData();
                const dataToSave = {
                    ...resumeData,
                    avatar: avatarDataUrl,
                    moduleOrder: moduleOrder,
                    fixedModules: fixedModules
                };
                localStorage.setItem('resumeData', JSON.stringify(dataToSave));
            } catch (e) {
                console.error('ä¿å­˜æ•°æ®å¤±è´¥:', e);
            }
        }

        // åˆå§‹åŒ–
        function init() {
            // å°è¯•ä»localStorageåŠ è½½
            const savedData = loadFromLocalStorage();
            if (savedData) {
                resumeData = {
                    basic: savedData.basic || resumeData.basic,
                    education: savedData.education || resumeData.education,
                    skills: savedData.skills || resumeData.skills,
                    work: savedData.work || resumeData.work,
                    project: savedData.project || resumeData.project,
                    awards: savedData.awards || resumeData.awards,
                    research: savedData.research || resumeData.research,
                    portfolio: savedData.portfolio || resumeData.portfolio,
                    objective: savedData.objective || resumeData.objective,
                    other: savedData.other || resumeData.other,
                    intro: savedData.intro || resumeData.intro
                };

                if (savedData.avatar) {
                    avatarDataUrl = savedData.avatar;
                    const img = document.getElementById('avatar-img');
                    const placeholder = document.querySelector('.avatar-upload .placeholder');
                    img.src = avatarDataUrl;
                    img.classList.remove('hidden');
                    placeholder.classList.add('hidden');
                }
            }

            loadDataToForm();
            renderEducation();
            renderWork();
            renderProject();
            renderResearch();
            updatePreview();

            // æ¸²æŸ“æ¨¡å—é¡ºåºåˆ—è¡¨
            renderModuleOrder();
            // åº”ç”¨æ¨¡å—å¯è§æ€§å’Œé¡ºåº
            applyModuleVisibility();
            reorderSections();

            setupListeners();
        }

        // åº”ç”¨æ¨¡å—å¯è§æ€§
        function applyModuleVisibility() {
            // åº”ç”¨å›ºå®šæ¨¡å—å¯è§æ€§
            Object.values(fixedModules).forEach(module => {
                const element = document.getElementById(module.section);
                if (element) {
                    element.classList.toggle('hidden', !module.visible);
                }
            });

            // åº”ç”¨å¯è°ƒæ•´æ¨¡å—å¯è§æ€§
            moduleOrder.forEach(module => {
                const element = document.getElementById(module.section);
                if (element) {
                    element.classList.toggle('hidden', !module.visible);
                }
            });
        }

        // åŠ è½½æ•°æ®åˆ°è¡¨å•
        function loadDataToForm() {
            document.getElementById('input-name').value = resumeData.basic.name;
            document.getElementById('input-job-title').value = resumeData.basic.jobTitle;
            document.getElementById('input-phone').value = resumeData.basic.phone;
            document.getElementById('input-email').value = resumeData.basic.email;
            document.getElementById('input-location').value = resumeData.basic.location;
            document.getElementById('input-website').value = resumeData.basic.website;
            document.getElementById('input-github').value = resumeData.basic.github;
            document.getElementById('input-skills').value = resumeData.skills;
            document.getElementById('input-awards').value = resumeData.awards;
            document.getElementById('input-portfolio').value = resumeData.portfolio;
            document.getElementById('input-position').value = resumeData.objective.position;
            document.getElementById('input-city').value = resumeData.objective.city;
            document.getElementById('input-salary').value = resumeData.objective.salary;
            document.getElementById('input-other').value = resumeData.other;
            document.getElementById('input-intro').value = resumeData.intro;
        }

        // ä»è¡¨å•æ”¶é›†æ•°æ®
        function collectData() {
            resumeData.basic = {
                name: document.getElementById('input-name').value,
                jobTitle: document.getElementById('input-job-title').value,
                phone: document.getElementById('input-phone').value,
                email: document.getElementById('input-email').value,
                location: document.getElementById('input-location').value,
                website: document.getElementById('input-website').value,
                github: document.getElementById('input-github').value
            };
            resumeData.skills = document.getElementById('input-skills').value;
            resumeData.awards = document.getElementById('input-awards').value;
            resumeData.portfolio = document.getElementById('input-portfolio').value;
            resumeData.objective = {
                position: document.getElementById('input-position').value,
                city: document.getElementById('input-city').value,
                salary: document.getElementById('input-salary').value
            };
            resumeData.other = document.getElementById('input-other').value;
            resumeData.intro = document.getElementById('input-intro').value;
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬
        function setupListeners() {
            // åŸºæœ¬ä¿¡æ¯ç›‘å¬
            const basicInputs = ['input-name', 'input-job-title', 'input-phone', 'input-email', 'input-location', 'input-website', 'input-github'];
            basicInputs.forEach(id => {
                document.getElementById(id).addEventListener('input', () => {
                    collectData();
                    updatePreview();
                });
            });

            // å…¶ä»–å­—æ®µç›‘å¬
            const otherInputs = ['input-skills', 'input-awards', 'input-portfolio', 'input-position', 'input-city', 'input-salary', 'input-other', 'input-intro'];
            otherInputs.forEach(id => {
                document.getElementById(id).addEventListener('input', () => {
                    collectData();
                    updatePreview();
                });
            });
        }

        // æ›´æ–°é¢„è§ˆ
        function updatePreview() {
            const basic = resumeData.basic;

            // åŸºæœ¬ä¿¡æ¯
            document.getElementById('resume-name').textContent = basic.name;
            document.getElementById('resume-job-title').textContent = basic.jobTitle;

            // è”ç³»æ–¹å¼ - åªæ˜¾ç¤ºéç©ºçš„
            const phoneEl = document.getElementById('contact-phone');
            const emailEl = document.getElementById('contact-email');
            const locationEl = document.getElementById('contact-location');
            const websiteEl = document.getElementById('contact-website');
            const githubEl = document.getElementById('contact-github');

            phoneEl.classList.toggle('hidden', !basic.phone);
            emailEl.classList.toggle('hidden', !basic.email);
            locationEl.classList.toggle('hidden', !basic.location);
            websiteEl.classList.toggle('hidden', !basic.website);
            githubEl.classList.toggle('hidden', !basic.github);

            document.getElementById('resume-phone').textContent = basic.phone;
            document.getElementById('resume-email').textContent = basic.email;
            document.getElementById('resume-location').textContent = basic.location;
            document.getElementById('resume-website').textContent = basic.website;
            document.getElementById('resume-github').textContent = basic.github ? `github.com/${basic.github}` : '';

            // æŠ€èƒ½
            document.getElementById('resume-skills').textContent = resumeData.skills || '';

            // å¥–é¡¹
            const awards = resumeData.awards.split('\n').filter(s => s.trim());
            document.getElementById('resume-awards').innerHTML = awards.map(a => `<li>${a}</li>`).join('');

            // ä½œå“é›†
            const portfolio = resumeData.portfolio.split('\n').filter(s => s.trim());
            document.getElementById('resume-portfolio').innerHTML = portfolio.map(p => `<li>${p}</li>`).join('');

            // æ±‚èŒæ„å‘
            document.getElementById('resume-position').textContent = resumeData.objective.position;
            document.getElementById('resume-city').textContent = resumeData.objective.city;
            document.getElementById('resume-salary').textContent = resumeData.objective.salary;

            // å…¶ä»–ç»å†
            const other = resumeData.other.split('\n').filter(s => s.trim());
            document.getElementById('resume-other').innerHTML = other.map(o => `<li>${o}</li>`).join('');

            // ä¸ªäººç®€ä»‹
            document.getElementById('resume-intro').textContent = resumeData.intro;

            // éšè—ç©ºå†…å®¹çš„æ¨¡å—
            hideEmptySections();

            // è‡ªåŠ¨ä¿å­˜åˆ°localStorage
            saveToLocalStorage();
        }

        // éšè—ç©ºå†…å®¹çš„æ¨¡å—
        function hideEmptySections() {
            // æ•™è‚²ç»å†
            const hasEducation = resumeData.education.some(e => e.school && e.major);
            document.getElementById('section-education').classList.toggle('hidden', !hasEducation);

            // ä¸“ä¸šæŠ€èƒ½
            document.getElementById('section-skills').classList.toggle('hidden', !resumeData.skills.trim());

            // å·¥ä½œç»å†
            const hasWork = resumeData.work.some(w => w.company && w.position);
            document.getElementById('section-work').classList.toggle('hidden', !hasWork);

            // é¡¹ç›®ç»å†
            const hasProject = resumeData.project.some(p => p.name && p.role);
            document.getElementById('section-project').classList.toggle('hidden', !hasProject);

            // è£èª‰å¥–é¡¹
            document.getElementById('section-awards').classList.toggle('hidden', !resumeData.awards.trim());

            // ç ”ç©¶ç»å†
            const hasResearch = resumeData.research.some(r => r.title && r.role);
            document.getElementById('section-research').classList.toggle('hidden', !hasResearch);

            // ä½œå“é›†
            document.getElementById('section-portfolio').classList.toggle('hidden', !resumeData.portfolio.trim());

            // æ±‚èŒæ„å‘
            const hasObjective = resumeData.objective.position || resumeData.objective.city || resumeData.objective.salary;
            document.getElementById('section-objective').classList.toggle('hidden', !hasObjective);

            // å…¶ä»–ç»å†
            document.getElementById('section-other').classList.toggle('hidden', !resumeData.other.trim());

            // ä¸ªäººç®€ä»‹
            document.getElementById('section-intro').classList.toggle('hidden', !resumeData.intro.trim());
        }

        // å¤´åƒä¸Šä¼ 
        function handleAvatarUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    avatarDataUrl = e.target.result;
                    const img = document.getElementById('avatar-img');
                    const placeholder = document.querySelector('.avatar-upload .placeholder');
                    img.src = avatarDataUrl;
                    img.classList.remove('hidden');
                    placeholder.classList.add('hidden');
                    // è‡ªåŠ¨ä¿å­˜
                    saveToLocalStorage();
                };
                reader.readAsDataURL(file);
            }
        }

        // æ•™è‚²ç»å†
        function addEducation() {
            resumeData.education.push({ school: '', major: '', degree: '', time: '' });
            renderEducation();
        }

        function removeEducation(index) {
            resumeData.education.splice(index, 1);
            renderEducation();
        }

        function updateEducation(index, field, value) {
            resumeData.education[index][field] = value;
            renderEducationPreview();
        }

        function renderEducation() {
            const container = document.getElementById('education-list');
            container.innerHTML = resumeData.education.map((item, index) => `
                <div class="dynamic-item">
                    <div class="form-group">
                        <label>å­¦æ ¡</label>
                        <input type="text" value="${item.school}" onchange="updateEducation(${index}, 'school', this.value)">
                    </div>
                    <div class="form-group">
                        <label>ä¸“ä¸š</label>
                        <input type="text" value="${item.major}" onchange="updateEducation(${index}, 'major', this.value)">
                    </div>
                    <div class="form-group">
                        <label>å­¦ä½</label>
                        <input type="text" value="${item.degree}" onchange="updateEducation(${index}, 'degree', this.value)">
                    </div>
                    <div class="form-group">
                        <label>æ—¶é—´</label>
                        <input type="text" value="${item.time}" onchange="updateEducation(${index}, 'time', this.value)">
                    </div>
                    <button class="btn btn-danger" onclick="removeEducation(${index})">åˆ é™¤</button>
                </div>
            `).join('');
            renderEducationPreview();
        }

        function renderEducationPreview() {
            const container = document.getElementById('resume-education');
            container.innerHTML = resumeData.education.map(item => `
                <div class="education-item">
                    <div class="item-header">
                        <div class="education-main">
                            <span class="item-title">${item.school}</span>
                            <span>${item.major}</span>
                            <span>${item.degree}</span>
                        </div>
                        <div class="item-date">${item.time}</div>
                    </div>
                </div>
            `).join('');
        }

        // å·¥ä½œç»å†
        function addWork() {
            resumeData.work.push({ company: '', position: '', time: '', description: '' });
            renderWork();
        }

        function removeWork(index) {
            resumeData.work.splice(index, 1);
            renderWork();
        }

        function updateWork(index, field, value) {
            resumeData.work[index][field] = value;
            renderWorkPreview();
        }

        function renderWork() {
            const container = document.getElementById('work-list');
            container.innerHTML = resumeData.work.map((item, index) => `
                <div class="dynamic-item">
                    <div class="form-group">
                        <label>å…¬å¸</label>
                        <input type="text" value="${item.company}" onchange="updateWork(${index}, 'company', this.value)">
                    </div>
                    <div class="form-group">
                        <label>èŒä½</label>
                        <input type="text" value="${item.position}" onchange="updateWork(${index}, 'position', this.value)">
                    </div>
                    <div class="form-group">
                        <label>æ—¶é—´</label>
                        <input type="text" value="${item.time}" onchange="updateWork(${index}, 'time', this.value)">
                    </div>
                    <div class="form-group">
                        <label>æè¿°</label>
                        <textarea onchange="updateWork(${index}, 'description', this.value)">${item.description}</textarea>
                    </div>
                    <button class="btn btn-danger" onclick="removeWork(${index})">åˆ é™¤</button>
                </div>
            `).join('');
            renderWorkPreview();
        }

        function renderWorkPreview() {
            const container = document.getElementById('resume-work');
            container.innerHTML = resumeData.work.map(item => `
                <div class="work-item">
                    <div class="item-header">
                        <div class="item-title">${item.company}</div>
                        <div class="item-date">${item.time}</div>
                    </div>
                    <div class="item-subtitle">${item.position}</div>
                    <div class="item-description">${item.description}</div>
                </div>
            `).join('');
        }

        // é¡¹ç›®ç»å†
        function addProject() {
            resumeData.project.push({ name: '', role: '', time: '', description: '' });
            renderProject();
        }

        function removeProject(index) {
            resumeData.project.splice(index, 1);
            renderProject();
        }

        function updateProject(index, field, value) {
            resumeData.project[index][field] = value;
            renderProjectPreview();
        }

        function renderProject() {
            const container = document.getElementById('project-list');
            container.innerHTML = resumeData.project.map((item, index) => `
                <div class="dynamic-item">
                    <div class="form-group">
                        <label>é¡¹ç›®åç§°</label>
                        <input type="text" value="${item.name}" onchange="updateProject(${index}, 'name', this.value)">
                    </div>
                    <div class="form-group">
                        <label>æ‹…ä»»è§’è‰²</label>
                        <input type="text" value="${item.role}" onchange="updateProject(${index}, 'role', this.value)">
                    </div>
                    <div class="form-group">
                        <label>æ—¶é—´</label>
                        <input type="text" value="${item.time}" onchange="updateProject(${index}, 'time', this.value)">
                    </div>
                    <div class="form-group">
                        <label>é¡¹ç›®æè¿°</label>
                        <textarea onchange="updateProject(${index}, 'description', this.value)">${item.description}</textarea>
                    </div>
                    <button class="btn btn-danger" onclick="removeProject(${index})">åˆ é™¤</button>
                </div>
            `).join('');
            renderProjectPreview();
        }

        function renderProjectPreview() {
            const container = document.getElementById('resume-project');
            container.innerHTML = resumeData.project.map(item => `
                <div class="project-item">
                    <div class="item-header">
                        <div class="item-title">${item.name}</div>
                        <div class="item-date">${item.time}</div>
                    </div>
                    <div class="item-subtitle">${item.role}</div>
                    <div class="item-description">${item.description}</div>
                </div>
            `).join('');
        }

        // ç ”ç©¶ç»å†
        function addResearch() {
            resumeData.research.push({ title: '', role: '', time: '', description: '' });
            renderResearch();
        }

        function removeResearch(index) {
            resumeData.research.splice(index, 1);
            renderResearch();
        }

        function updateResearch(index, field, value) {
            resumeData.research[index][field] = value;
            renderResearchPreview();
        }

        function renderResearch() {
            const container = document.getElementById('research-list');
            container.innerHTML = resumeData.research.map((item, index) => `
                <div class="dynamic-item">
                    <div class="form-group">
                        <label>ç ”ç©¶è¯¾é¢˜</label>
                        <input type="text" value="${item.title}" onchange="updateResearch(${index}, 'title', this.value)">
                    </div>
                    <div class="form-group">
                        <label>æ‹…ä»»è§’è‰²</label>
                        <input type="text" value="${item.role}" onchange="updateResearch(${index}, 'role', this.value)">
                    </div>
                    <div class="form-group">
                        <label>æ—¶é—´</label>
                        <input type="text" value="${item.time}" onchange="updateResearch(${index}, 'time', this.value)">
                    </div>
                    <div class="form-group">
                        <label>ç ”ç©¶æè¿°</label>
                        <textarea onchange="updateResearch(${index}, 'description', this.value)">${item.description}</textarea>
                    </div>
                    <button class="btn btn-danger" onclick="removeResearch(${index})">åˆ é™¤</button>
                </div>
            `).join('');
            renderResearchPreview();
        }

        function renderResearchPreview() {
            const container = document.getElementById('resume-research');
            container.innerHTML = resumeData.research.map(item => `
                <div class="research-item">
                    <div class="item-header">
                        <div class="item-title">${item.title}</div>
                        <div class="item-date">${item.time}</div>
                    </div>
                    <div class="item-subtitle">${item.role}</div>
                    <div class="item-description">${item.description}</div>
                </div>
            `).join('');
        }

        // å¯¼å‡ºJSON
        function exportJSON() {
            collectData();
            const dataToExport = {
                ...resumeData,
                avatar: avatarDataUrl
            };
            const blob = new Blob([JSON.stringify(dataToExport, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ç®€å†æ•°æ®.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        // å¯¼å…¥JSON
        function importJSON(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        resumeData = {
                            basic: importedData.basic || resumeData.basic,
                            education: importedData.education || [],
                            skills: importedData.skills || '',
                            work: importedData.work || [],
                            project: importedData.project || [],
                            awards: importedData.awards || '',
                            research: importedData.research || [],
                            portfolio: importedData.portfolio || '',
                            objective: importedData.objective || resumeData.objective,
                            other: importedData.other || '',
                            intro: importedData.intro || ''
                        };

                        if (importedData.avatar) {
                            avatarDataUrl = importedData.avatar;
                            const img = document.getElementById('avatar-img');
                            const placeholder = document.querySelector('.avatar-upload .placeholder');
                            img.src = avatarDataUrl;
                            img.classList.remove('hidden');
                            placeholder.classList.add('hidden');
                        }

                        loadDataToForm();
                        renderEducation();
                        renderWork();
                        renderProject();
                        renderResearch();
                        updatePreview();
                        alert('å¯¼å…¥æˆåŠŸï¼');
                    } catch (error) {
                        alert('å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥JSONæ–‡ä»¶æ ¼å¼ï¼');
                        console.error(error);
                    }
                };
                reader.readAsText(file);
            }
            // é‡ç½®inputä»¥ä¾¿é‡å¤å¯¼å…¥åŒä¸€æ–‡ä»¶
            event.target.value = '';
        }

        // æ¸…é™¤æœ¬åœ°ç¼“å­˜
        function clearCache() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æœ¬åœ°ç¼“å­˜å—ï¼Ÿè¿™å°†åˆ é™¤æ‰€æœ‰å·²ä¿å­˜çš„ç®€å†æ•°æ®ï¼Œæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) {
                localStorage.removeItem('resumeData');
                alert('ç¼“å­˜å·²æ¸…é™¤ï¼é¡µé¢å°†é‡æ–°åŠ è½½ã€‚');
                location.reload();
            }
        }

        // å¯¼å‡ºPDF
        async function exportPDF() {
            const { jsPDF } = window.jspdf;
            const resume = document.getElementById('resume');

            const canvas = await html2canvas(resume, {
                scale: 3,
                useCORS: true,
                logging: false
            });

            const imgData = canvas.toDataURL('image/png');
            const pdf = new jsPDF('p', 'mm', 'a4');

            const imgWidth = 210; // A4å®½åº¦
            const pageHeight = 297; // A4é«˜åº¦
            const imgHeight = (canvas.height * imgWidth) / canvas.width;

            // æ·»åŠ å®¹å·®ï¼Œé¿å…å› ä¸ºæµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜äº§ç”Ÿå¤šä½™çš„ç©ºç™½é¡µ
            const tolerance = 1; // 1mmå®¹å·®

            if (imgHeight <= pageHeight + tolerance) {
                // å†…å®¹åœ¨ä¸€é¡µå†…ï¼Œç›´æ¥è¾“å‡º
                pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
            } else {
                // å†…å®¹çœŸæ­£è¶…è¿‡ä¸€é¡µï¼Œéœ€è¦åˆ†é¡µ
                let heightLeft = imgHeight;
                let position = 0;

                while (heightLeft > 0) {
                    const heightOnPage = Math.min(heightLeft, pageHeight);
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, heightOnPage);
                    heightLeft -= pageHeight;
                    position -= pageHeight;

                    if (heightLeft > 0) {
                        pdf.addPage();
                    }
                }
            }

            pdf.save('ç®€å†.pdf');
        }

        // å¯¼å‡ºå›¾ç‰‡
        async function exportImage() {
            const resume = document.getElementById('resume');

            const canvas = await html2canvas(resume, {
                scale: 3,
                useCORS: true,
                logging: false
            });

            const link = document.createElement('a');
            link.download = 'ç®€å†.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
